# Rate Limitter

## what is rate limit ?

- rate limit is the mechanism which is used to control the rate of traffic sent from client to server means if api request
  has exceeds the threshold defined by rate limiter, then all the exceeding request will be block not processed further.

## Explain each rate limit algorithm?

There are 5 algorithm :-

- Token Bucket Algorithm - ` In this algorithm we have a predefined capacity of a bucket which fill at periodically rate of time(like 2 token per minutes will be filled in the bucket). each request will take a one token and once the token in bucket hit the threshold value after that all the request will be dropped. This is simple to implement and most widely used by companies. This algorithm is allowed to served a burst of traffic at short of period of time.`

- Leaky Bucket Algorithm - `This algorithm is similar to the Token Bucket Algorithm only the difference is that it served the api request at fixed rate(like 1 request per second will be served). This algorithm follows FIFO pattern. when request is arrived its check whether the queue capacity is full or empty if it have some space then it will add the request in queue. If the capacity of queue is full then its drop the request and the request which is in the queue are taken out at a fixed rate of interval are served. Only cons of this alogrithm looks to me that its will not able to handle the burst of traffic when its come its will be filled with old request only and new request will be dropped.`

- Fixed Window Counter Alogrithm - `In this algorithm we divided the timeline into a fixed size of window and we assign a counter to each window. whenever a request arrive we will increment the counter by 1. if counter has reached to the predefined threshold of window its will drop the request until new timeline window start. suppose rate limit can served 5 request per second. so here time will be divide into the fixed window size that will be second window. In each second time window if request come more than the 5 request then 5 request will be served and other will be dropped until new window second start. Only cons looks to that its can serve more than allowed request for example take a fixed window timeline to be 1 minutes and its can server 5 request per minute. so, suppose 5 request arrived at 03:00:30(HH:MM:SS) and when 1 minutes complete at 03:01:00 window counter got reset and after that again 5 request come at 03:01:15 it will served the request. but if we calculate the window size from 03:00:30 to 03:01:15 that will be approx (~ 1 minutes)  we have served the 10 requests. why this happend because we are taking the window size a timeline and we are not keeping the track of last timeline its request was proccessed. we simply resetting the window counter on actual timeline minutes.`

- Sliding Window log Algorithm - `This algorithm is basically upgrations of Fixed window counter algorithm to solve the edge cases of its. In this algorithm we keep the track of requested timestamp and store in the cache like redis set. we store the timestamp at which request is come, we will remove outdated timestamp and if it's under the predefined threshold we will allowed the request to proceed otherwise its will drop if reach the threshold value. How this work let's see suppose we have a rate limit of 2 request per minute and a request arrived at 02:00:01 we will store it, remove outdated timestamp and now we will check does the size of window exceed the predefined threshold if not we will proceed the request other wise we will drop the request. Now one more request arrived at 02:00:30 we will store it, remove outdated timestamp and now again check the window size if not exceed threshold we will proceed the request and till now we have stored the two timestamp 02:00:01 and 02:00:30 and again one more reuqest arrive 02:00:40 and we will store it, remove outdated timestamp and check size of window its exceed so, we will drop the request but we will not remove the timestamp. we will remove only those timestamp which are outdated from current window timestamp( [previous_timestamp,current_timestamp) between these timestamp are only kept rest are removed). Since we can see in window we have 02:00:01, 02:00:30 and 02:00:40 since its become 3 we will drop the 02:00:40 request. now request came at 02:01:40 we will store it and removed the outdated timestamp if its have(02:00:01 and 02:00:30 timestamp are removed and we will keep 02:00:40 and 02:01:40) and check the window size does its exceed or not if not then we will proceed the request. Currently cons i think its have that since its declined the 02:00:40 request and two request came at 02:01:40 then its will serve only one request and one its dropped off. we saw that its only served one request.`

- sliding window counter algorithm - `This algorithm is hybrid approach which combine two method fixed window counter and sliding window log. This algorithm is implemented by two methods are :- `-`1. Assume rate limit allow 7 request per minute. Now a 5 request come in previous 1 minute timeline and next 3 request come in current 1 minute timeline. so for the current timeline till now its only 30% so we will use to calculate the approx request come in a 1 minute window time line if exceed we will drop and if not exceed we will proceed the requests. To calculate the request we will use this formula`**(request in current window + (request in previous window \_ overlap percentage of current and previous window))**`we will round off the result which will come and we will check the new result with threshold defined value. Since it is memory efficient because we are not storing the timestamp. storing a timestamp might be expensive.`-`2. In this approach we divide the entire window time into a smaller buckets. size of each bucket depend on how much elasticity is allowed for the rate limiter. each bucket store the request count corresponding to the bucket range. suppose rate limit have 10 request per hour than we divide the window size into 3 smaller bucket which will create a range of 20 min buckets. for bucket time 02:00:00 to 03:00:00 it will have [{02:20:00 : 2},{02:40:00 : 5},{03:00:00: 1}] we have total request 8 in that window. Ideally this approach is not a good it will have same issue as we have faced in fixed window counter. here only its will happen that it will drop the request.`
